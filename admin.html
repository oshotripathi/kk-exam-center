<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KK Admin Panel</title>

<style>
body{margin:0;font-family:Segoe UI;display:flex;height:100vh;transition:.3s;}
body.dark{background:#121212;color:#fff;}

.sidebar{
width:250px;
background:#2c3e50;
color:white;
padding:20px;
overflow:auto;
}
.sidebar h2{margin-top:0;}
.sidebar button{
width:100%;
margin:6px 0;
padding:10px;
border:none;
background:#34495e;
color:white;
border-radius:8px;
cursor:pointer;
}

.main{flex:1;padding:20px;overflow:auto;}

.card{
background:white;
padding:20px;
border-radius:12px;
box-shadow:0 8px 20px rgba(0,0,0,.15);
margin-bottom:20px;
}
body.dark .card{background:#1e1e1e;}

input,select{
width:100%;
padding:10px;
margin:6px 0;
border-radius:8px;
border:1px solid #ccc;
}

.q-item{
padding:15px;
border-radius:10px;
background:#f5f5f5;
margin-bottom:12px;
}
body.dark .q-item{background:#2a2a2a;}

.correct{background:green;color:white;padding:3px 6px;border-radius:5px;}

button.action{padding:6px 10px;border:none;border-radius:6px;margin-right:5px;cursor:pointer;}
.edit{background:orange;color:white;}
.delete{background:red;color:white;}

.chapterTabs button{
margin:5px 5px 5px 0;
padding:8px 12px;
border:none;
border-radius:6px;
cursor:pointer;
background:#3498db;
color:white;
}

.pagination button{
margin:5px;
padding:6px 10px;
border:none;
border-radius:6px;
cursor:pointer;
background:#2c3e50;
color:white;
}

.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,.5);
display:none;
justify-content:center;
align-items:center;
}
.modalContent{
background:white;
padding:20px;
width:400px;
border-radius:12px;
}
body.dark .modalContent{background:#1e1e1e;}

/* MOBILE RESPONSIVE */
@media (max-width: 768px){

body{
flex-direction:column;
}

.sidebar{
position:fixed;
left:-260px;
top:0;
height:100%;
z-index:1000;
transition:.3s;
}

.sidebar.active{
left:0;
}

.main{
padding:15px;
}

.menuBtn{
position:fixed;
top:15px;
left:15px;
z-index:1100;
background:#2c3e50;
color:white;
border:none;
padding:8px 12px;
border-radius:6px;
cursor:pointer;
}

.modalContent{
width:90%;
}

}



  
</style>
</head>
<body>
<button class="menuBtn" onclick="toggleMenu()">â˜°</button>
<div class="sidebar">
<h2>KK Admin</h2>
<div id="categoryList"></div>
<hr>
<button onclick="toggleDark()">ðŸŒ™ Toggle</button>
<button onclick="logout()">Logout</button>
</div>

<div class="main">

<div id="loginBox" class="card">
<h3>Admin Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
</div>

<div id="panel" style="display:none">

<h2 id="selectedTitle">Dashboard</h2>

<div class="chapterTabs" id="chapterTabs"></div>

<input id="searchBox" placeholder="Search in this chapter">
<button onclick="showAddForm()" style="background:green;color:white;padding:8px 15px;border:none;border-radius:6px;margin:10px 0;">
+ Add Question
</button>
  
<div id="chapterForm" class="card" style="display:none;">
<h3>Add New Chapter</h3>
<input id="newChapterName" placeholder="Chapter Name">
<button onclick="addChapter()">Save</button>
<button onclick="closeChapterForm()">Cancel</button>
</div>
  
<div id="questionList"></div>

<div class="pagination" id="pagination"></div>
<div id="addForm" class="card" style="display:none;">
<h3>Add Question</h3>

<input id="newQ" placeholder="Question">
<input id="newOp1" placeholder="Option 1">
<input id="newOp2" placeholder="Option 2">
<input id="newOp3" placeholder="Option 3">
<input id="newOp4" placeholder="Option 4">

<select id="newAns">
<option value="0">Option 1</option>
<option value="1">Option 2</option>
<option value="2">Option 3</option>
<option value="3">Option 4</option>
</select>

<button onclick="addQuestion()">Save Question</button>
<button onclick="closeAddForm()">Cancel</button>
</div>
</div>

</div>

<div class="modal" id="editModal">
<div class="modalContent">
<h3>Edit Question</h3>
<input id="editQ">
<input id="editOp1">
<input id="editOp2">
<input id="editOp3">
<input id="editOp4">
<select id="editAns">
<option value="0">Option 1</option>
<option value="1">Option 2</option>
<option value="2">Option 3</option>
<option value="3">Option 4</option>
</select>
<button onclick="saveEdit()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = { apiKey: "AIzaSyCGqcunQhA9qXge7_nWZfIMWDQczs5OUBY", authDomain: "kk-exam-center.firebaseapp.com", projectId: "kk-exam-center", storageBucket: "kk-exam-center.firebasestorage.app", messagingSenderId: "960789555084", appId: "1:960789555084:web:d4ed5391fdd95a9d4ad8a9", measurementId: "G-YHTHGDR7Q2" };
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

let allQuestions=[];
let selectedCategory="";
let selectedChapter="";
let currentPage=1;
let perPage=10;
let currentEditId=null;

/* LOGIN */
window.login=async()=>{
try{await signInWithEmailAndPassword(auth,email.value,password.value);}
catch(e){loginMsg.innerText="Login Failed";}
};

onAuthStateChanged(auth,(user)=>{
if(user){
loginBox.style.display="none";
panel.style.display="block";
listenQuestions();
}else{
loginBox.style.display="block";
panel.style.display="none";
}
});

window.logout = async () => {

await signOut(auth);

/* Clear Input Fields */
email.value = "";
password.value = "";

/* Optional: remove saved autofill */
email.setAttribute("autocomplete","off");
password.setAttribute("autocomplete","new-password");

};

/* LIVE DATA */
function listenQuestions(){
onSnapshot(collection(db,"questions"),(snapshot)=>{
allQuestions=[];
snapshot.forEach(d=>{
let data=d.data();
data.id=d.id;
allQuestions.push(data);
});
loadCategories();
});
}

  window.showAddForm = function(){

if(!selectedCategory || !selectedChapter){
alert("Please select Category and Chapter first");
return;
}

addForm.style.display="block";
};

window.closeAddForm = function(){
addForm.style.display="none";
};


window.toggleMenu = function(){
document.querySelector(".sidebar").classList.toggle("active");
};

  
/* LOAD CATEGORIES */
function loadCategories(){
let categories=[...new Set(allQuestions.map(q=>q.category))];
categoryList.innerHTML="";
categories.forEach(cat=>{
categoryList.innerHTML+=`
<button onclick="openCategory('${cat}')">
${getCategoryName(cat)}
</button>`;
});
}




  
  function getCategoryName(cat){
if(cat === "ssc") return "SSC Maths";
if(cat === "lekhpal") return "SSC English";
return cat.toUpperCase();
}



window.showAddChapter = function(){
chapterForm.style.display = "block";
};

window.closeChapterForm = function(){
chapterForm.style.display = "none";
};

window.addChapter = function(){

if(!selectedCategory){
alert("Select category first");
return;
}

let ch = newChapterName.value;

if(!ch){
alert("Enter chapter name");
return;
}

/* Chapter create karne ke liye dummy doc add karenge */
addDoc(collection(db,"questions"),{
category:selectedCategory,
chapter:ch,
question:"(Empty Chapter)",
option1:"",
option2:"",
option3:"",
option4:"",
answer:0,
isChapterPlaceholder:true
});

chapterForm.style.display="none";
newChapterName.value="";
alert("Chapter Created");

};

  window.toggleMenu = function(){
document.querySelector(".sidebar").classList.toggle("active");
};


  document.querySelectorAll(".sidebar button").forEach(btn=>{
btn.addEventListener("click",()=>{
if(window.innerWidth < 768){
document.querySelector(".sidebar").classList.remove("active");
}
});
});


  window.addQuestion = async function(){

if(!selectedCategory || !selectedChapter){
alert("Select category & chapter first");
return;
}

await addDoc(collection(db,"questions"),{
category:selectedCategory,
chapter:selectedChapter,
question:newQ.value,
option1:newOp1.value,
option2:newOp2.value,
option3:newOp3.value,
option4:newOp4.value,
answer:Number(newAns.value)
});

alert("Question Added Successfully");

addForm.style.display="none";

newQ.value="";
newOp1.value="";
newOp2.value="";
newOp3.value="";
newOp4.value="";
};

/* OPEN CATEGORY */
window.openCategory = function(cat){

selectedCategory = cat;
selectedChapter = "";
selectedTitle.innerText = getCategoryName(cat);

/* Reset UI */
questionList.innerHTML = "";
pagination.innerHTML = "";

/* Add Chapter Button Top Pe */
chapterTabs.innerHTML = `
<button onclick="showAddChapter()" 
style="background:green;color:white;margin-bottom:10px;">
+ Add Chapter
</button>
<hr>
`;

/* Unique Chapters Find */
let chapters = [...new Set(
allQuestions
.filter(q => q.category === cat)
.map(q => q.chapter)
)];

/* Render Chapter Buttons */
chapters.forEach(ch => {

chapterTabs.innerHTML += `
<div style="display:inline-flex;align-items:center;margin:5px;">
<button onclick="openChapter('${ch}')" 
style="margin-right:5px;">
${ch}
</button>

<button onclick="deleteChapter('${ch}')" 
style="background:red;color:white;padding:5px 8px;border:none;border-radius:4px;">
âœ•
</button>
</div>
`;

});

};

/* OPEN CHAPTER */
window.openChapter=function(ch){
selectedChapter=ch;
currentPage=1;
renderQuestions();
};

/* RENDER QUESTIONS */
function renderQuestions(){
let filtered=allQuestions.filter(q=>
q.category===selectedCategory &&
q.chapter===selectedChapter
);

let searchVal=searchBox.value?.toLowerCase()||"";
filtered=filtered.filter(q=>q.question.toLowerCase().includes(searchVal));

let totalPages=Math.ceil(filtered.length/perPage);
let start=(currentPage-1)*perPage;
let end=start+perPage;

let pageData=filtered.slice(start,end);

questionList.innerHTML="";
pageData.forEach(q=>{
questionList.innerHTML+=`
<div class="q-item">
<b>${q.question}</b>
<ul>
<li class="${q.answer==0?'correct':''}">${q.option1}</li>
<li class="${q.answer==1?'correct':''}">${q.option2}</li>
<li class="${q.answer==2?'correct':''}">${q.option3}</li>
<li class="${q.answer==3?'correct':''}">${q.option4}</li>
</ul>
<button class="action edit" onclick="openEdit('${q.id}')">Edit</button>
<button class="action delete" onclick="deleteQuestion('${q.id}')">Delete</button>
</div>`;
});

renderPagination(totalPages);
}

function renderPagination(totalPages){
pagination.innerHTML="";
for(let i=1;i<=totalPages;i++){
pagination.innerHTML+=`
<button onclick="goPage(${i})">${i}</button>`;
}
}

window.goPage=function(p){
currentPage=p;
renderQuestions();
};

searchBox.addEventListener("input",renderQuestions);

/* DELETE */
window.deleteQuestion=async(id)=>{
if(confirm("Delete this question?")){
await deleteDoc(doc(db,"questions",id));
}
};

  window.deleteChapter = async function(ch){

if(!confirm("Delete this chapter and all its questions?")) return;

let toDelete = allQuestions.filter(q =>
q.category === selectedCategory &&
q.chapter === ch
);

for(let q of toDelete){
await deleteDoc(doc(db,"questions",q.id));
}

alert("Chapter Deleted");

};

/* EDIT */
window.openEdit=function(id){
let q=allQuestions.find(x=>x.id===id);
currentEditId=id;
editQ.value=q.question;
editOp1.value=q.option1;
editOp2.value=q.option2;
editOp3.value=q.option3;
editOp4.value=q.option4;
editAns.value=q.answer;
editModal.style.display="flex";
};

window.saveEdit=async()=>{
await updateDoc(doc(db,"questions",currentEditId),{
question:editQ.value,
option1:editOp1.value,
option2:editOp2.value,
option3:editOp3.value,
option4:editOp4.value,
answer:Number(editAns.value)
});
editModal.style.display="none";
};

window.closeModal=()=>{editModal.style.display="none";};

/* DARK MODE */
window.toggleDark=()=>{
document.body.classList.toggle("dark");
localStorage.setItem("theme",
document.body.classList.contains("dark")?"dark":"light");
};

if(localStorage.getItem("theme")=="dark"){
document.body.classList.add("dark");
}
</script>

</body>
</html>
