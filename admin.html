<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KK Advanced Admin Panel</title>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  display:flex;
  height:100vh;
  transition:.3s;
}
body.dark{background:#121212;color:#fff;}

.sidebar{
  width:230px;
  background:#2c3e50;
  color:white;
  padding:20px;
}
.sidebar h2{margin-top:0;}
.sidebar button{
  width:100%;
  margin:8px 0;
  padding:10px;
  border:none;
  background:#34495e;
  color:white;
  border-radius:8px;
  cursor:pointer;
}
.main{
  flex:1;
  padding:20px;
  overflow:auto;
}
.card{
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
  margin-bottom:20px;
}
body.dark .card{background:#1e1e1e;}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
}

button.action{
  padding:6px 10px;
  margin-right:6px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.edit{background:orange;color:white;}
.delete{background:red;color:white;}
.addBtn{background:green;color:white;padding:10px;}

.q-item{
  padding:15px;
  border-radius:10px;
  background:#f5f5f5;
  margin-bottom:12px;
}
body.dark .q-item{background:#2a2a2a;}

.correct{
  background:green;
  color:white;
  padding:3px 6px;
  border-radius:5px;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.modal{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
}
.modalContent{
  background:white;
  padding:20px;
  width:400px;
  border-radius:12px;
}
body.dark .modalContent{background:#1e1e1e;}
</style>
</head>
<body>

<div class="sidebar">
<h2>KK Admin</h2>
<button onclick="showDashboard()">Dashboard</button>
<button onclick="showAdd()">Add Question</button>
<button onclick="toggleDark()">ðŸŒ™ Toggle</button>
<button onclick="logout()">Logout</button>
</div>

<div class="main">

<div id="loginBox" class="card">
<h3>Admin Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
</div>

<div id="panel" style="display:none">

<div class="topbar">
<h2>Dashboard</h2>
<input id="searchBox" placeholder="Search Question">
</div>

<div class="card">
Total Questions: <b id="totalQ">0</b>
</div>

<div id="questionList"></div>

</div>

<div id="addSection" style="display:none">
<div class="card">
<h3>Add Question</h3>
<input id="newCategory" placeholder="Category">
<input id="newChapter" placeholder="Chapter">
<input id="newQ" placeholder="Question">
<input id="newOp1" placeholder="Option 1">
<input id="newOp2" placeholder="Option 2">
<input id="newOp3" placeholder="Option 3">
<input id="newOp4" placeholder="Option 4">
<select id="newAns">
<option value="0">Option 1</option>
<option value="1">Option 2</option>
<option value="2">Option 3</option>
<option value="3">Option 4</option>
</select>
<button class="addBtn" onclick="addQuestion()">Add Question</button>
</div>
</div>

</div>

<div class="modal" id="editModal">
<div class="modalContent">
<h3>Edit Question</h3>
<input id="editQ">
<input id="editOp1">
<input id="editOp2">
<input id="editOp3">
<input id="editOp4">
<select id="editAns">
<option value="0">Option 1</option>
<option value="1">Option 2</option>
<option value="2">Option 3</option>
<option value="3">Option 4</option>
</select>
<button onclick="saveEdit()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = { apiKey: "AIzaSyCGqcunQhA9qXge7_nWZfIMWDQczs5OUBY", authDomain: "kk-exam-center.firebaseapp.com", projectId: "kk-exam-center", storageBucket: "kk-exam-center.firebasestorage.app", messagingSenderId: "960789555084", appId: "1:960789555084:web:d4ed5391fdd95a9d4ad8a9", measurementId: "G-YHTHGDR7Q2" };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentEditId=null;
let allQuestions=[];

/* LOGIN */
window.login=async()=>{
try{
await signInWithEmailAndPassword(auth,email.value,password.value);
}catch(e){loginMsg.innerText="Login Failed";}
};

onAuthStateChanged(auth,(user)=>{
if(user){
loginBox.style.display="none";
panel.style.display="block";
listenQuestions();
}else{
loginBox.style.display="block";
panel.style.display="none";
}
});

window.logout=async()=>{await signOut(auth);};

function listenQuestions(){
onSnapshot(collection(db,"questions"),(snapshot)=>{
allQuestions=[];
questionList.innerHTML="";
snapshot.forEach(d=>{
let data=d.data();
data.id=d.id;
allQuestions.push(data);
});
renderQuestions(allQuestions);
totalQ.innerText=allQuestions.length;
});
}

function renderQuestions(data){
questionList.innerHTML="";
data.forEach(q=>{
questionList.innerHTML+=`
<div class="q-item">
<b>${q.question}</b>
<ul>
<li class="${q.answer==0?'correct':''}">${q.option1}</li>
<li class="${q.answer==1?'correct':''}">${q.option2}</li>
<li class="${q.answer==2?'correct':''}">${q.option3}</li>
<li class="${q.answer==3?'correct':''}">${q.option4}</li>
</ul>
<button class="action edit" onclick="openEdit('${q.id}')">Edit</button>
<button class="action delete" onclick="removeQuestion('${q.id}')">Delete</button>
</div>`;
});
}

searchBox.addEventListener("input",()=>{
let val=searchBox.value.toLowerCase();
let filtered=allQuestions.filter(q=>q.question.toLowerCase().includes(val));
renderQuestions(filtered);
});

window.addQuestion=async()=>{
await addDoc(collection(db,"questions"),{
category:newCategory.value,
chapter:newChapter.value,
question:newQ.value,
option1:newOp1.value,
option2:newOp2.value,
option3:newOp3.value,
option4:newOp4.value,
answer:Number(newAns.value)
});
alert("Added!");
};

window.removeQuestion=async(id)=>{
if(confirm("Delete this question?")){
await deleteDoc(doc(db,"questions",id));
}
};

window.openEdit=(id)=>{
let q=allQuestions.find(x=>x.id===id);
currentEditId=id;
editQ.value=q.question;
editOp1.value=q.option1;
editOp2.value=q.option2;
editOp3.value=q.option3;
editOp4.value=q.option4;
editAns.value=q.answer;
editModal.style.display="flex";
};

window.saveEdit=async()=>{
await updateDoc(doc(db,"questions",currentEditId),{
question:editQ.value,
option1:editOp1.value,
option2:editOp2.value,
option3:editOp3.value,
option4:editOp4.value,
answer:Number(editAns.value)
});
editModal.style.display="none";
};

window.closeModal=()=>{editModal.style.display="none";};

window.showAdd=()=>{
panel.style.display="none";
addSection.style.display="block";
};

window.showDashboard=()=>{
panel.style.display="block";
addSection.style.display="none";
};

window.toggleDark=()=>{
document.body.classList.toggle("dark");
localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
};

if(localStorage.getItem("theme")=="dark"){
document.body.classList.add("dark");
}
</script>

</body>
</html>
